#include "source/neslib_asm/neslib.h"
#include "source/menus/title.h"
#include "source/globals.h"
#include "source/configuration/game_states.h"
#include "source/configuration/system_constants.h"
#include "source/menus/text_helpers.h"
#include "source/graphics/palettes.h"
#include "source/configuration/game_info.h"
#include "source/graphics/fade_animation.h"

CODE_BANK(PRG_BANK_TITLE);

const unsigned char title_1[231]={
0x01,0x00,0x01,0x40,0xe0,0xf6,0x00,0x24,0x45,0x50,0x54,0x48,0x53,0x00,0xf6,0x01,
0x12,0xe1,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x34,0x45,0x58,
0x54,0x00,0x57,0x49,0x4c,0x4c,0x00,0x4c,0x49,0x56,0x45,0x00,0x48,0x45,0x52,0x45,
0x00,0x01,0x07,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x33,
0x4f,0x4d,0x45,0x00,0x44,0x41,0x59,0x0e,0x01,0x02,0x00,0x01,0x0f,0xe4,0x00,0x00,
0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,
0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,
0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,
0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,
0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,
0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,
0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,
0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,
0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xf0,0xf6,0x01,0x1b,
0xf1,0x00,0x01,0x7f,0x00,0x01,0x00
};

const unsigned char prestart[318]={
0x01,0x00,0x01,0x40,0xe0,0xf6,0x00,0x24,0x45,0x50,0x54,0x48,0x53,0x00,0xf6,0x01,
0x12,0xe1,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,
0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,
0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x08,0x23,0x55,0x52,0x52,0x45,
0x4e,0x43,0x59,0x00,0x01,0x0a,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,
0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,
0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x34,0x48,0x45,0x00,0x46,0x41,0x43,0x54,0x00,
0x4f,0x52,0x00,0x51,0x55,0x41,0x4c,0x49,0x54,0x59,0x00,0x4f,0x46,0x00,0x01,0x04,
0xe4,0x00,0x00,0xe4,0x00,0x42,0x45,0x49,0x4e,0x47,0x00,0x47,0x45,0x4e,0x45,0x52,
0x41,0x4c,0x4c,0x59,0x00,0x41,0x43,0x43,0x45,0x50,0x54,0x45,0x44,0x00,0x01,0x02,
0xe4,0x00,0x00,0xe4,0x00,0x4f,0x52,0x00,0x49,0x4e,0x00,0x55,0x53,0x45,0x0e,0x00,
0x01,0x10,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,
0xe6,0x00,0x00,0xe4,0x00,0x33,0x59,0x4e,0x1a,0x30,0x52,0x45,0x56,0x41,0x4c,0x45,
0x4e,0x43,0x45,0x0c,0x23,0x49,0x52,0x43,0x55,0x4c,0x41,0x54,0x49,0x4f,0x4e,0x00,
0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,
0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,
0x00,0x0d,0x00,0x34,0x48,0x45,0x00,0x2f,0x58,0x46,0x4f,0x52,0x44,0x00,0x24,0x49,
0x43,0x54,0x49,0x4f,0x4e,0x41,0x52,0x59,0x00,0x01,0x03,0xe4,0x00,0x00,0xe4,0x00,
0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,0xe4,0x00,0x00,0xe4,0x00,0x01,0x1b,
0xe4,0x00,0x00,0xf0,0xf6,0x01,0x1b,0xf1,0x00,0x01,0x7f,0x00,0x01,0x00
};


unsigned char titlePhase;


void draw_title_screen(void) {
	titlePhase = 0;
    ppu_off();
	pal_bg(titlePalette);
	pal_spr(titlePalette);

	set_chr_bank_0(CHR_BANK_MENU);
    set_chr_bank_1(CHR_BANK_MENU);
	oam_clear();

	vram_adr(NAMETABLE_A);
	vram_unrle(prestart);
    
	ppu_on_all();
	gameState = GAME_STATE_TITLE_INPUT;
}

void draw_title_screen_real(void) {
	fade_out();
    ppu_off();
	pal_bg(titlePalette);
	pal_spr(titlePalette);

	set_chr_bank_0(CHR_BANK_MENU);
    set_chr_bank_1(CHR_BANK_MENU);
	clear_screen();
	oam_clear();

    
    put_str(NTADR_A(12, 5), gameName);
	
	put_str(NTADR_A(2, 26), gameAuthorContact);
	
	put_str(NTADR_A(2, 28), "Copyright");
	put_str(NTADR_A(12, 28), currentYear);
	put_str(NTADR_A(17, 28), gameAuthor);

	put_str(NTADR_A(10, 16), "Press Start!");
	ppu_on_all();
	fade_in();
}

void draw_title1(void) {
	fade_out();
    ppu_off();

	vram_adr(NAMETABLE_A);
	vram_unrle(title_1);

	ppu_on_all();
	fade_in();

}

void handle_title_input(void) {

	++tempChara;
	if (titlePhase == 0 && tempChara == 192) {
		++titlePhase;
		draw_title_screen_real();
	}

	if (titlePhase == 1 && pad_trigger(0) & PAD_START) {
		++titlePhase;
		draw_title1();
		return;
	}
	if (titlePhase == 2 && pad_trigger(0) & PAD_START) {
		gameState = GAME_STATE_POST_TITLE;
		return;
	}
}